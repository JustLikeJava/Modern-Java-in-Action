# Chapter 15 CompletableFuture와 리액티브 프로그래밍 컨셉의 기초

## 한번 읽은 것으로는 잘 이해가 가지 않아 추후 다시 읽어볼 예정

- 최근 소프트웨어 개발 방법을 획기적으로 뒤집는 2가지 방법
  - 하드웨어와 관련된 것
  - 애플리케이션을 어떻게 구성하는가와 관련된 것
- 마이크로서비스 아키텍처 선택
  - 작은 서비스로 애플리케이션을 나누는 것
  - 서비스가 작아진 대신 네트워크 통신이 증가
- 다양한 소스의 콘텐츠를 가져와서 사용자가 삶을 풍요롭게 만들도록 합치는 `매시업 형태`
- 서비스를 기다리는 동안 귀중한 `CPU 클록 사이클 자원`을 낭비하고 싶지 않다
- 조금씩 연관된 작업을 같은 CPU에서 동작하는 것
- 애플리케이션 생산성을 극대화할 수 있도록 코어를 바쁘게 유지하는 것
- `동시성` : 단일 코어 머신에서 발생
- `병렬성` : 하드웨어 수준에서 실행

## 1. 동시성을 구현하는 자바 자원의 진화
- 처음 자바는 `Runnable`과 `Thread`를 동기화된 클래스와 메서드를 이용해 잠갔다
- 매시업 애플리케이션을 이용해 실시간으로 정보를 조합해 사용자에게 제공하거나 추가 웹 서비스를 통해 제공
- 이 과정을 `리액티브 프로그래밍` (동시성 + 병렬성)
- 운영체제는 각 사용자에게 `프로세스` 하나를 할당
- 프로세스는 운영체제에게 한개 이상의 `스레드`를 요청
- **자바 스레드는 직접 운영체제 스레드에 접근**
- 운영체제 스레드의 개수는 제한되어 있고 비용이 비싸다
- 따라서 `스레드 풀`을 만들어서 사용
  - 사용하지 않은 스레드로 제출된 테스크를 먼저 온 순서대로 실행
- 스레드 풀의 주의사항
  - k 스레드를 가진 스레드 풀은 오직 k만큼의 스레드를 동시에 실행
    - I/O를 기다리거나 네트워크 연결을 기다리는 테스크가 있다면 주의
    - 기존 실행중인 테스크가 나중 테스크 제출을 기다리는 상황이라면 데드락 주의
  - 프로그램을 종료하기 전 모든 스레드 풀을 종료하는 습관
- 메서드가 반환된 후에도 만들어진 테스크 실행이 계속되는 메서드를 `비동기 메서드`
- `데몬 스레드` : 애플리케이션이 종료될 때 강제 종료

<br>

## 2. 동기 API와 비동기 API
- 2가지 단계로 병렬성을 이용
  - 외부 반복을 내부 반복으로 바꿔서 사용
  - 복잡한 스레드 작업을 하지 않고 병렬로 요소가 처리되도록 사용
- `Future` 형식 API
  - 원래 바디를 평가하는 테스크를 포함하는 Future 반환
  - `get()` 메서드를 통해 기다림
- `리액티브` 형식 API
  - 콜백 형식 프로그래밍 이용
- API는 명시적으로 스레드를 처리하는 코드에 비해 사용 코드를 더 단순하게 만들어주며 높은 수준의 구조를 유지
- `sleep()` 메서드는 여전히 시스템 자원을 점유하기에 해로운 것으로 간주
- 이상적으로는 절대 테스크에서 기다리는 일을 만들지 않거나 코드에서 예외를 일으키는 방법으로 처리
- **테스크를 블록하는 것보다는 다음 작업을 테스크로 제출하고 현재 테스크는 종료하는 것이 바람직**

<br>

## 3. 박스와 채널 모델
- 동시성 모델을 가장 잘 설계하고 개념화한 것이 `박스와 채널 모델`

<br>

## 4. CompletableFuture와 콤비네이터를 이용한 동시성
- `Future` 인터페이스의 구현인 `CompletableFuture`를 이용해 Future를 조합할 수 있는 기능 추가
- `complete()` 메서드를 이용해 다른 스레드가 이를 완료할 수 있고 `get()`으로 값을 얻을 수 있다
- `thenCombine()` 메서드는 두 개의 CompletableFuture 값을 받아 한 개의 새 값을 생성

<br>

## 5. 발행-구독 그리고 리액티브 프로그래밍
- `Future`는 한 번만 실행해 결과를 제공
- 리액티브 프로그래밍은 여러 결과를 제공한다
- 스트림이 떠오르지만 스트림은 선형적인 파이프라인 처리 기법에 알맞다
- 발행자 : `Publisher<T>`
  - `subscribe()` : 구독자를 받아 구독하도록 하는 함수
- 구독자 : `Subscriber<T>`
  - `onNext()` : 변화가 발생했을 때 실행되는 함수

<br>

## 6. 리액티브 시스템 vs 리액티브 프로그래밍
- `리액티브 시스템` : 런타임 환경의 변화에 대응하도록 전체 아키텍처가 설계된 프로그램