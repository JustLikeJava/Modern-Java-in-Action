## Chapter 01



### 1.1 역사의 흐름은 무엇인가?

- 자바 역사를 통틀어 가장 큰 변화가 `자바 8` 에서 발생
  - 자연어에 더 가깝게 간단한 방식으로 코드를 구현 가능

- 대부분의 자바 프로그램은 코어 중 하나만을 사용
  - `자바 8` 이 등장하기 이전에는 나머지 코어를 활용하려면 스레드를 사용하라고 조언
  - 스레드 사용은 관리가 어렵고 많은 문제가 발생
  - `자바 8` 에서는 병렬 실행을 새롭고 단순한 방식으로 접근할 수 있는 방법 제공



### 1.2 왜 아직도 자바는 변화하는가?

- 수많은 프로그래밍 언어 중 완벽한 프로그래밍 언어를 찾고자 지속적인 노력
- 하지만 현실적으로 그러한 언어는 존재하지 않고 모든 언어가 장단점 보유
  - C, C++는 프로그래밍 안전성은 부족, 작은 런타임 풋프린트 덕분에 운영체제와 다양한 임베디드 시스템에서 인기
  - 하지만 C, C++의 낮은 안정성 때문에 프로그램이 예기치 않게 종료되거나 바이러스 등이 침투할 수 있는 보안 구멍 존재
  - 실제 런타임 풋프린트에 여유가 있는 애플리케이션에서는 자바, C# 같이 안전한 형식의 언어가 압도

- 자바는 출발부터 많은 유용한 라이브러리를 포함하는 잘 설계된 객체 지향 언어
  - 스레드와 락으로 소소한 동시성도 제공
  - `캡슐화`와 `객체지향의 정신적인 모델`로 대중적인 프로그래밍 언어로 발전
  - 초기에는 C/C++에 비해 추가적으로 드는 비용(시간) 때문에 반감이 존재했으나 하드웨어의 발전으로 프로그래머의 시간이 더욱 중요한 요소로 부각

- 빅데이터 등 계속해서 새로운 도전 과제를 마주하게 되고 변화하는 환경에 빠르게 적응하면서 점점 대중화



#### 스트림 처리

- 한 번에 한 개씩 만들어지는 연속적인 데이터 항목들의 모임

- `자바 8` 에는 java.util.stream 패키지에 `스트림 API`가 추가

- `스트림 API` 는 파이프라인을 만드는 데 필요한 많은 메서드 제공

  -> 한 번에 한 항목이 아닌 일련의 스트림으로 만들어 처리

  -> 스트림 파이프라인을 이용해 여러 CPU 코어에 쉽게 할당

  -> 복잡한 스레드를 사용하지 않고 병렬성



#### 동작 파라미터화로 메서드에 코드 전달하기

- 코드 일부를 API로 전달하는 기능
- `자바 8` 이전에는 메서드를 다른 메서드로 전달할 방법이 X



#### 병렬성과 공유 가변 데이터

- 스트림 메서드로 전달하는 코드는 다른 코드와 동시에 실행하더라도 안전하게 실행되어야 한다.
- 안전하게 실행할 수 있는 코드를 만들려면 `공유된 가변 데이터`에 접근하지 않아야 한다.
  - 이러한 함수를 순수(pure) 함수, 부작용 없는(side-effect-free) 함수, 상태 없는(stateless) 함수

- `synchronized`를 이용해 공유된 가변 데이터를 보호하는 규칙
  - `synchronized`는 시스템 성능에 악영향

- 자바 8의 `스트림`을 이용하면 기존의 자바 스레드 API보다 쉽게 병렬성을 활용



### 1.3 자바 함수

- `함수(function)`라는 용어는 `정적 메서드(static method)`와 같은 의미로 사용
- 함수를 값처럼 취급한다는 것에 대한 의미
  - 프로그래밍 언어의 핵심은 값을 바꾸는 것 : 대부분의 것들이 값으로 이루어져 있기 때문
  - 전통적인 값들은 `일급 시민`, 전달할 수 없는 구조체는 `이급 시민` (메서드, 클래스 등)
  - 이급 시민을 일급 시민으로 만들면 프로그래밍에 유용하게 활용 가능



#### 메서드와 람다를 일급 시민으로

- 자바 8의 설계자들은 메서드를 값으로 취급할 수 있게 하여 프로그래머들이 더 쉽게 프로그램을 구현할 수 있는 환경 제공

1. 메서드 참조(method reference)

   ``` java
   File[] hiddenFiles = new File(".").listFiles(new FileFilter() {
     public boolean accept(File file) {
       return file.isHidden();
     }
   })
   ```

   - 기존에는 File 클래스의 `isHidden` 메소드를 사용하기 위해 이러한 방식을 사용할 수 밖에 없었다.

   ``` java
   File[] hiddenFiles = new File(".").listFiles(File::isHidden);
   ```

   - 자바 8에서는 `메서드 참조`를 이용하여 코드를 마음대로 전달할 수 있다



#### 람다 : 익명 함수

- `자바 8` 에서는 메서드를 일급값으로 취급할 뿐 아니라 **람다**(또는 익명 함수)를 포함하여 함수도 값으로 취급
- 람다 문법 형식으로 구현된 프로그램을 함수형 프로그래밍
  - '함수를 일급값으로 넘겨주는 프로그램을 구현한다'



#### 메서드 전달에서 람다로

- 메서드를 값으로 전달하는 것은 유용하지만 한두 번만 사용할 메서드를 매번 정의하는 것은 귀찮은 일
- 람다가 몇 줄 이상으로 길어진다면 익명 람다보다는 코드가 수행하는 일을 잘 설명하는 메서드를 정의하고 메서드 참조 활용
  - `코드의 명확성`이 우선



### 1.4 스트림

- 거의 모든 자바 애플리케이션은 `컬렉션`을 만들고 활용
- `스트림 API`를 이용하면 `컬렉션 API`와는 상당히 다른 방식으로 데이터를 처리 가능
  - `컬렉션 API` : **for-each** 루프를 이용해서 각 요소를 반복하면서 작업 수행 => `외부 반복(external iteration)`
  - `스트림 API` : 라이브러리 내부에서 모든 데이터가 처리 => `내부 반복(internal iteration)`



#### 멀티스레딩은 어렵다

- 이전 자바 버전에서 제공하는 `스레드 API` 로 **멀티 스레딩** 코드를 구현해서 병렬성 이용은 어려움
  - 각각의 스레드는 공유된 데이터에 접근, 데이터를 갱신, 원치 않은 변경 발생

- `라이브러리`에서 이러한 반복되는 패턴을 제공하면 좋을 것이라는 아이디어가 변화의 동기
  - Ex) 필터링, 추출, 그룹화 등

- `컬렉션`은 어떻게 데이터를 저장하고 접근할지에 중점, `스트림`은 데이터에 어떤 계산을 할 것인지 묘사하는 것에 중점

- 스트림은 스트림 내의 요소를 `쉽게 병렬로 처리할 수 있는 환경`을 제공한다는 것이 핵심

  ``` java
  import static java.util.stream.Collectors.toList;
  List<Apple> heavyApples =
    inventory.stream().filter((Apple a) -> a.getWeight() > 150)
    									.collect(toList());
  ```

  - 각각의 객체마다 필터 적용 후 하나의 List로 생성
  - 순차 처리 방식

  ``` java
  import static java.util.stream.Collectors.toList();
  List<Apple> heavyApples =
    inventory.parallelStream().filter((Apple a) -> a.getWeight > 150)
    													.collect(toList());
  ```

  - 병렬 처리 방식



### 1.5 디폴트 메서드와 자바 모듈

- 프로그래머가 디폴트 메서드를 구현하는 상황은 흔치 않다.
  - 디폴트 메서드는 특정 프로그램을 구현하는 데 도움을 주는 기능이 아니라 미래에 프로그램이 쉽게 변화할 수 있는 환경을 제공하는 기능

- 디폴트 메서드를 이용하면 기존의 코드를 건드리지 않고도 원래의 인터페이스 설계를 자유롭게 확장
  - `default` 라는 새로운 키워드 지원



### 1.6 함수형 프로그래밍에서 가져온 다른 유용한 아이디어

- 함수형 프로그래밍의 핵심적인 두 아이디어
  1. 메서드와 람다를 일급값으로 사용하는 것
  2. 가변 공유 상태가 없는 병렬 실행을 이용해 효율적이고 안전하게 함수나 메서드를 호출

- 자바 8에서는 NullPointer 예외를 피할 수 있도록 도와주는 `Optional<T>` 클래스를 제공



### 1.7 생각 정리

- `스레드`를 사용하는데 있어 깊이 있는 이해가 부족하였고 관리가 어렵고 많은 문제를 야기하는 것을 깨달았다.
- 자바의 `Collection` 에 대해 다시금 정리가 필요하다는 생각이 들었다.
- `스트림 API`의 내부 동작과 병렬 처리에 대한 깊이 있는 이해가 필요함을 느꼈다.