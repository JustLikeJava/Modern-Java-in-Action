# Chapter 19. 함수형 프로그래밍 기법

## 19.1 함수는 모든 곳에 존재한다.
18장에서 함수형 프로그래밍이란 함수나 메서드가 수학의 함수처럼 동작함을, 즉 부작용 없이 동작함을 의미했다. 
함수형 언어 프로그래머는 함수형 프로그래밍이라는 용어를 __함수를 마치 일반값처럼 사용해서 인수로 전달하거나, 결과로 반환받거나, 자료구조에 저장할 수 있음__ 을 의미한다.
일반값처럼 취급할수 있는 함수를 __일급 함수__ 라고 한다. 자바 8이 이전 버전과 구별되는 특징 중 하나가 일급 함수를 지원한다는 점이다.


### 19.1.1 고차원 함수
* 함수형 프로그래밍 커뮤니티에 따르면 다음 중 하나 이상의 동작을 수행하는 함수를 __고차원 함수__ 라 부른다.
    * 하나 이상의 함수를 인수로 받음
    * 함수를 결과로 반환
    * ex) Comparator.comparing
        ```java
        Comparator<Apple> c = comparing(Apple::getWeight);
        ```
    * 자바 8에선 함수를 인수로 전달할 수 있을 뿐 아니라 결과로 반환하고, 지역 변수로 할당하거나, 구조체로 삽입할 수 있으므로 자바 8의 함수도 고차원 함수라고 할 수 있다.


### 19.1.2 커링
대부분의 애플리케이션은 국제화를 지원해야 하는데 이때 단위 변환 문제가 발생할 수 있다.
예를 들어 다음은 섭씨를 화씨로 변환하는 공식이다.
``` CtoF(x) = x*9/5 + 32 ```

다음과 같은 패턴으로 단위를 표현할 수 있다.
1. 변환 요소를 곱함
2. 기준치 조정 요소를 적용

다음과 같은 메서드로 변환 패턴을 표현할 수 있다.
```java 
/*
x: 변환하려는 값, f: 변환 요소, b: 기준치 조정 요소
*/
static double converter(double x, double f, double b){ 
    return x * f + b;
}
```
세 개의 인수를 받는 converter라는 메서드를 만들어 문제를 해결하는 방법도 있지만 인수에 변환 요소와 기준치를 넣는 일은 번거롭고 오타도 발생하기 쉽다.
각각을 변환하는 메서드를 따로 만드는 방법도 있지만 그러면 로직을 재활용하지 못한다는 단점이 있다.

기존 로직을 활용해서 converter를 특정 상황에 적용할 수 있는 방법이 있다. 다음은 __커링__ 이라는 개념을 활용해서 한 개의 인수를 갖는 변환 함수를 생산하는 "팩토리"를 정의하는 코드다.
```java
static DoubleUnaryOperator curriedConverter(double f, b){
    return (double x) -> x * f + b;
}
```
위 메서드에 변환요소 f와 기준치 b만 넘겨주면 우리가 원하는 작업을 수행할 함수가 반환된다. 결과적으로 기존의 변환 로직을 재활용하는 유연한 코드를 얻었다.

* __커링의 이론적 정의__
    * __커링__: x와 y라는 두 인수를 받는 함수 f를 한 개의 인수를 받는 g라는 함수로 대체하는 기법이다. (함수를 모듈화하고 코르들 재사용할 수 있도록 지원하는 기법이다.)
    * 이때 g라는 함수 역시 하나의 인수를 받는 함수를 반환한다.
    * 함수 g와 원래 함수 f가 최종적으로 반환하는 값은 같다. 즉, f(x,y) = (g(x))(y) 가 성립한다.
    * 물론 이 과정을 일반화할 수 있다.(앞선 예제와 같이)



## 19.2 영속 자료구조
함수형 프로그램에선 함수형 자료구조, 불변 자료구조 등의 용어도 사용하지만 보통은 __영속 자료구조__ 라고 부른다.


### 19.2.1 파괴적인 갱신과 함수형
함수형에서는 자료구조를 바꾸면서 생기는 부작용을 수반하는 메서드를 제한한다. 
계산 결과를 표현할 자료구조가 필요하면 기존의 자료구조를 갱신하지 않도록 새로운 자료구조를 만든다.



## 19.3 스트림과 게으른 평가
스트림은 단 한 번만 소비할 수 있다는 제약이 있어서 스트림은 재귀적으로 정의할 수 없다. 


### 19.3.1 자기 정의 스트림
스트림이 실제로 필요할 때만 스트림을 평가하는 방식을 사용해 바로 위에서 언급한 문제를 해결할 수 있다.(__게으른 평가__)


### 19.3.2 게으른 리스트 만들기
자바 8의 스트림은 요청할 때만 값을 생성한다. 스트림에 일련의 연산을 적용하면 연산이 수행되지 않고 일단 저장된다. 
스트림에 __최종 연산__ 을 적용해서 실제 계산을 해야 하는 상황에서만 실제 연산이 이루어진다.(filter, map, reduce 등 연산을 적용할 때 이런 특성을 활용 가능하다.)
이런 게으른 특성 때문에 __각 연산별로 스트림을 탐색할 필요 없이 한 번에 여러 연산을 처리할 수 있다.__

* __게으른 리스트__
    * 고차원 함수라는 개념을 지원한다.
    * 함숫값을 자료구조에서 저장해서 함숫값을 사용하지 않은 상태로 보관할 수 있다. 
    * 저장한 함숫값을 호출(요청)하면 더 많은 자료구조를 만들 수 있다.

게으른 자료구조가 애플리케이션을 구현하는 데 도움을 준다면 게으른 자료구조를 사용하자. 하지만 게으른 자료구조 때문에 효율성이 떨어진다면 전통적인 방식으로 코드를 구현하자.



## 19.5 기타 정보
### 19.5.1 캐싱 또는 기억화
참조 투명성을 유지하는 상황에선 계산 결과를 캐시할 수 있다.

### 19.5.3 콤비네이터
콤비네이터는 둘 이상의 함수나 자료구조를 조합하는 함수형 개념이다.
 