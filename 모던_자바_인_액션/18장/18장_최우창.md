# Chapter 18 함수형 관점으로 생각하기

## 1. 시스템 구현과 유지보수
- 실제 경험해본 적 없는 대규모 소프트웨어 시스템 업그레이드 관리 요청이 들어왔을 때
  - `synchronized` 키워드가 존재하면 제안을 거절 (동시성 버그 수정은 어려운 일)
- 자바 8의 스트림을 이용하면 잠금 문제를 신경 쓰지 않을 수 있었다
  - 처리 도중 내부 데이터 변화가 없기 때문
- 클래스 계층으로 프로그램을 반영하면 시스템 구조 이해에 용이
- `결합성` : 다른 모듈간의 관계, 낮게할수록 유리
- `응집성` : 모듈 내부에서의 관계, 높게할수록 유리
- `공유 가변 데이터 구조` : 시스템의 여러 메서드에서 데이터를 읽고 갱신하는 구조
- `순수 메서드(부작용 없는 메서드)` : 객체의 상태를 바꾸지 않으며 return 문을 통해서만 자신의 결과를 반환하는 메서드
- **부작용**
  - 자료구조를 고치거나 필드에 값을 할당(setter 메서드 같은 생성자 이외의 초기화 동작)
  - 예외 발생
  - 파일 쓰기 등의 I/O 동작 수행
- **불변 객체**
  - 불변 객체는 복사하지 않고 공유할 수 있으며, 객체의 상태를 바꿀 수 없기에 스레드 안전성을 제공
  - 잠금을 사용하지 않고도 멀티코어 병렬성을 사용

### 선언형 프로그래밍
- `어떻게`에 집중하는 고전 객체 지향 프로그래밍
- `무엇`에 집중하는 선언형 프로그래밍
  - 스트림의 `내부 반복`
- `함수형 프로그래밍`은 선언형 프로그래밍을 따르는 대표적인 방식

<br>

## 2. 함수형 프로그래밍이란 무엇인가?
- 함수를 이용하는 프로그래밍
- 함수는 0개 이상의 인수를 가지며 한 개 이상의 결과를 반환하지만 부작용이 없어야 한다
- 함수 그리고 if-then-else 등의 수학적 표현만 사용하는 방식을 `순수 함수형 프로그래밍`
- 시스템의 다른 부분에 영향을 미치지 않는다면 내부적으로는 함수형이 아닌 기능도 사용하는 방식을 `함수형 프로그래밍`
- 자바에서는 완벽한 순수 함수형 프로그래밍을 구현하기 어렵기 때문에 `함수형 프로그램`을 구현
  - 원하는 동작 이후 필드의 값을 돌려놓는다고 가정
  - 프로그램 입장에서 부작용이 사라졌지만 프로그래머 관점에서 프로그램 실행속도의 저하
- 함수나 메서드는 지역 변수만을 변경해야 `함수형`
- 다른 함수나 메서드에서 참조하는 객체가 있다면 그 객체는 불변 객체
- 함수형이라면 함수나 메서드가 어떤 `예외`도 일으키지 않아야 한다
  - `Optional`을 사용하면 문제를 해결
  - 호출자는 메서드 호출 결과로 빈 Optional이 반환되는지 확인

### 참조 투명성
- 같은 인수로 함수를 호출했을 때 항상 같은 결과를 반환한다면 참조적으로 투명한 함수
- 기억화 또는 캐싱을 통해 다시 계산하지 않고 저장하는 최적화 기능도 제공

<br>

## 3. 재귀와 반복
- 순수 함수형 프로그래밍 언어에서는 `while`, `for` 같은 반복문을 포함하지 않는다
  - 변화가 자연스럽게 코드에 스며들 수 있기 때문
- 이론적으로 반복을 이용하는 모든 프로그램은 재귀로도 구현 가능
  - 재귀를 이용하면 변화가 일어나지 않는다
- 일반적으로 반복코드보다 재귀 코드가 더 비싸다
  - 새로운 스택 프레임 생성
  - 메모리 사용량 증가
  - StackOverflowError

### 꼬리 호출 최적화
- 꼬리 재귀에서는 컴파일러가 하나의 스택 프레임을 재활용할 가능성
- 함수에 추가적인 연산없이 리턴만 하는 함수 생성
  - 스택 프레임 생성 X